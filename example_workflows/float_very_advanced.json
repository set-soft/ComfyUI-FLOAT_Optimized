{"id":"e15807ba-77e9-4e35-8f4a-f8d35122bb99","revision":0,"last_node_id":114,"last_link_id":221,"nodes":[{"id":82,"type":"PreviewImage","pos":[860,770],"size":[140,246],"flags":{},"order":30,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":175}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.40","Node name for S&R":"PreviewImage","widget_ue_connectable":{}},"widgets_values":[],"color":"#233","bgcolor":"#355"},{"id":57,"type":"VHS_VideoCombine","pos":[3061.744384765625,1158.3441162109375],"size":[270,598],"flags":{},"order":38,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":190},{"localized_name":"audio","name":"audio","shape":7,"type":"AUDIO","link":106},{"localized_name":"meta_batch","name":"meta_batch","shape":7,"type":"VHS_BatchManager","link":null},{"localized_name":"vae","name":"vae","shape":7,"type":"VAE","link":null},{"localized_name":"frame_rate","name":"frame_rate","type":"FLOAT","widget":{"name":"frame_rate"},"link":171},{"localized_name":"loop_count","name":"loop_count","type":"INT","widget":{"name":"loop_count"},"link":null},{"localized_name":"filename_prefix","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null},{"localized_name":"format","name":"format","type":"COMBO","widget":{"name":"format"},"link":null},{"localized_name":"pingpong","name":"pingpong","type":"BOOLEAN","widget":{"name":"pingpong"},"link":null},{"localized_name":"save_output","name":"save_output","type":"BOOLEAN","widget":{"name":"save_output"},"link":null}],"outputs":[{"localized_name":"Filenames","name":"Filenames","type":"VHS_FILENAMES","links":null}],"properties":{"cnr_id":"comfyui-videohelpersuite","ver":"4c7858ddd5126f7293dc3c9f6e0fc4c263cde079","Node name for S&R":"VHS_VideoCombine","widget_ue_connectable":{"frame_rate":true}},"widgets_values":{"frame_rate":30,"loop_count":0,"filename_prefix":"AnimateDiff","format":"video/nvenc_h264-mp4","pix_fmt":"yuv420p","bitrate":10,"megabit":true,"save_metadata":true,"pingpong":false,"save_output":true,"videopreview":{"hidden":false,"paused":false,"params":{"filename":"AnimateDiff_00028-audio.mp4","subfolder":"","type":"output","format":"video/nvenc_h264-mp4","frame_rate":25,"workflow":"AnimateDiff_00028.png","fullpath":"/home/salvador/0Data/IA/ComfyUI/output/AnimateDiff_00028-audio.mp4"}}},"color":"#222","bgcolor":"#000"},{"id":34,"type":"SET_AudioChannelConvResampler","pos":[571.986328125,1642.08935546875],"size":[327.1470642089844,82],"flags":{},"order":28,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"AUDIO","link":57},{"localized_name":"channel_conversion","name":"channel_conversion","type":"COMBO","widget":{"name":"channel_conversion"},"link":null},{"localized_name":"target_sample_rate","name":"target_sample_rate","type":"INT","widget":{"name":"target_sample_rate"},"link":172}],"outputs":[{"localized_name":"audio_out","name":"audio_out","type":"AUDIO","links":[158]}],"properties":{"cnr_id":"audio-batch","ver":"1.0.0","Node name for S&R":"SET_AudioChannelConvResampler","widget_ue_connectable":{"channel_conversion":true,"target_sample_rate":true}},"widgets_values":["force_mono",16000],"color":"#223","bgcolor":"#335"},{"id":106,"type":"MarkdownNote","pos":[540,1510],"size":[267.1470642089844,90],"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[],"title":"Audio Channel Conv and Resampler","properties":{"widget_ue_connectable":{}},"widgets_values":["This node ensures the audio is mono @ 16 kHz. Is part of my AudioBatch nodes."],"color":"#432","bgcolor":"#653"},{"id":55,"type":"LoadFloatSynthesisModel","pos":[887.9851684570312,1296.8486328125],"size":[417.1148376464844,214],"flags":{},"order":1,"mode":0,"inputs":[{"localized_name":"synthesis_file","name":"synthesis_file","type":"COMBO","widget":{"name":"synthesis_file"},"link":null},{"localized_name":"target_device","name":"target_device","type":"COMBO","widget":{"name":"target_device"},"link":null},{"localized_name":"channel_multiplier","name":"channel_multiplier","type":"INT","widget":{"name":"channel_multiplier"},"link":null},{"localized_name":"blur_kernel_str","name":"blur_kernel_str","type":"STRING","widget":{"name":"blur_kernel_str"},"link":null},{"localized_name":"cudnn_benchmark","name":"cudnn_benchmark","type":"BOOLEAN","widget":{"name":"cudnn_benchmark"},"link":null},{"localized_name":"advanced_float_options","name":"advanced_float_options","shape":7,"type":"ADV_FLOAT_DICT","link":null}],"outputs":[{"localized_name":"float_synthesis","name":"float_synthesis","type":"FLOAT_SYNTHESIS_MODEL","links":[113]},{"localized_name":"inferred_size","name":"inferred_size","type":"INT","links":null},{"localized_name":"inferred_style_dim","name":"inferred_style_dim","type":"INT","links":null},{"localized_name":"inferred_motion_dim","name":"inferred_motion_dim","type":"INT","links":null}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"6f4b3c5954ef4dbb69a1c40ea0e645103e4fe15c","Node name for S&R":"LoadFloatSynthesisModel","widget_ue_connectable":{"synthesis_file":true,"target_device":true,"channel_multiplier":true,"blur_kernel_str":true,"cudnn_benchmark":true}},"widgets_values":["decoder.safetensors","cuda",1,"[1, 3, 3, 1]",false],"color":"#2a363b","bgcolor":"#3f5159"},{"id":35,"type":"LoadAudioProjectionLayer","pos":[1380,1460],"size":[383.1812438964844,130],"flags":{"collapsed":false},"order":2,"mode":0,"inputs":[{"localized_name":"projection_file","name":"projection_file","type":"COMBO","widget":{"name":"projection_file"},"link":null},{"localized_name":"target_device","name":"target_device","type":"COMBO","widget":{"name":"target_device"},"link":null}],"outputs":[{"localized_name":"projection_layer","name":"projection_layer","type":"AUDIO_PROJECTION_LAYER","links":[61]},{"localized_name":"inferred_input_dim","name":"inferred_input_dim","type":"INT","links":null},{"localized_name":"dim_a","name":"dim_a","type":"INT","links":[]}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"002ed938d83c893aa7646ac933776dadfa84ac33","Node name for S&R":"LoadAudioProjectionLayer","widget_ue_connectable":{"projection_file":true,"target_device":true}},"widgets_values":["projection.safetensors","cuda"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":102,"type":"MarkdownNote","pos":[1380,1630],"size":[290,88],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[],"title":"Load Audio Projection Layer  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["Download this model from: [here](https://huggingface.co/set-soft/float_advanced/resolve/main/audio_projections/projection.safetensors?download=true)\n\nTo `ComfyUI/models/float/audio_projections/`"],"color":"#432","bgcolor":"#653"},{"id":58,"type":"FloatGetIdentityReferenceVA","pos":[1366.3167724609375,1204.29052734375],"size":[262.6831970214844,46],"flags":{},"order":33,"mode":0,"inputs":[{"localized_name":"r_s_lambda_latent","name":"r_s_lambda_latent","type":"TORCH_TENSOR","link":197},{"localized_name":"float_synthesis","name":"float_synthesis","type":"FLOAT_SYNTHESIS_MODEL","link":113}],"outputs":[{"localized_name":"float_synthesis_out","name":"float_synthesis_out","type":"FLOAT_SYNTHESIS_MODEL","links":[188]},{"localized_name":"r_s_latent (Wr→s)","name":"r_s_latent (Wr→s)","type":"TORCH_TENSOR","links":[215]}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"6f4b3c5954ef4dbb69a1c40ea0e645103e4fe15c","Node name for S&R":"FloatGetIdentityReferenceVA","widget_ue_connectable":{}},"widgets_values":[],"color":"#2a363b","bgcolor":"#3f5159"},{"id":101,"type":"MarkdownNote","pos":[1370,1290],"size":[262.6831970214844,88],"flags":{},"order":4,"mode":0,"inputs":[],"outputs":[],"title":"FLOAT Get Identity Reference  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["The output of this node represents the reference image conditioning (wr)"],"color":"#432","bgcolor":"#653"},{"id":89,"type":"ApplyFloatEncoder","pos":[850,1100],"size":[255.1171875,86],"flags":{},"order":31,"mode":0,"inputs":[{"localized_name":"ref_image","name":"ref_image","type":"IMAGE","link":191},{"localized_name":"float_encoder","name":"float_encoder","type":"FLOAT_ENCODER_MODEL","link":192}],"outputs":[{"localized_name":"appearance_pipe (Ws→r)","name":"appearance_pipe (Ws→r)","type":"FLOAT_APPEARANCE_PIPE","links":[198]},{"localized_name":"r_s_lambda_latent","name":"r_s_lambda_latent","type":"TORCH_TENSOR","links":[197]},{"localized_name":"float_encoder_out","name":"float_encoder_out","type":"FLOAT_ENCODER_MODEL","links":null}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"5787c6d5d82668b7c978f32f71e8731c5eaa0d8b","Node name for S&R":"ApplyFloatEncoder","widget_ue_connectable":{}},"widgets_values":[],"color":"#2a363b","bgcolor":"#3f5159"},{"id":99,"type":"MarkdownNote","pos":[1030,930],"size":[280,110],"flags":{},"order":5,"mode":0,"inputs":[],"outputs":[],"title":"Apply FLOAT Encoder  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["We first extract the \"identity\" of the image, which will be used to generate the video\n\nWe also extract the reference data for the FMT"],"color":"#432","bgcolor":"#653"},{"id":81,"type":"FloatImageFaceAlign","pos":[510,980],"size":[270,130],"flags":{},"order":27,"mode":4,"inputs":[{"localized_name":"image","name":"image","type":"IMAGE","link":174},{"localized_name":"face_margin","name":"face_margin","type":"FLOAT","widget":{"name":"face_margin"},"link":null},{"localized_name":"rgba_conversion","name":"rgba_conversion","type":"COMBO","widget":{"name":"rgba_conversion"},"link":null},{"localized_name":"bkg_color_hex","name":"bkg_color_hex","type":"STRING","widget":{"name":"bkg_color_hex"},"link":null},{"localized_name":"size","name":"size","shape":7,"type":"INT","widget":{"name":"size"},"link":183}],"outputs":[{"localized_name":"image","name":"image","type":"IMAGE","links":[175,191]}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"cd98751e337e7ad09488b7a1af6f8d298ccdd12f","Node name for S&R":"FloatImageFaceAlign","widget_ue_connectable":{}},"widgets_values":[1.6,"blend_with_color","#000000",512],"color":"#2a363b","bgcolor":"#3f5159"},{"id":98,"type":"MarkdownNote","pos":[500,810],"size":[280,110],"flags":{},"order":6,"mode":0,"inputs":[],"outputs":[],"title":"Face Align for FLOAT  (Ad)","properties":{"widget_ue_connectable":{}},"widgets_values":["The node below ensures the size of the image is correct.\n\nIt can detect faces and crop the image to put the face in correct place.\n\nEnable it if needed"],"color":"#432","bgcolor":"#653"},{"id":53,"type":"LoadFloatEncoderModel","pos":[210,1110],"size":[270,166],"flags":{},"order":7,"mode":0,"inputs":[{"localized_name":"encoder_file","name":"encoder_file","type":"COMBO","widget":{"name":"encoder_file"},"link":null},{"localized_name":"target_device","name":"target_device","type":"COMBO","widget":{"name":"target_device"},"link":null},{"localized_name":"cudnn_benchmark","name":"cudnn_benchmark","type":"BOOLEAN","widget":{"name":"cudnn_benchmark"},"link":null}],"outputs":[{"localized_name":"inferred_input_size","name":"inferred_input_size","type":"INT","links":[183]},{"localized_name":"dim_w","name":"dim_w","type":"INT","links":[]},{"localized_name":"dim_m","name":"dim_m","type":"INT","links":[]},{"localized_name":"float_encoder","name":"float_encoder","type":"FLOAT_ENCODER_MODEL","links":[192]}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"6f4b3c5954ef4dbb69a1c40ea0e645103e4fe15c","Node name for S&R":"LoadFloatEncoderModel","widget_ue_connectable":{"encoder_file":true,"target_device":true,"cudnn_benchmark":true}},"widgets_values":["encoder.safetensors","cuda",false],"color":"#2a363b","bgcolor":"#3f5159"},{"id":97,"type":"MarkdownNote","pos":[200,1330],"size":[290,88],"flags":{},"order":8,"mode":0,"inputs":[],"outputs":[],"title":"Load FLOAT Encoder  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["Download this model from: [here](https://huggingface.co/set-soft/float_advanced/resolve/main/motion_autoencoder/encoder.safetensors?download=true)\n\nTo `ComfyUI/models/float/motion_autoencoder/`"],"color":"#432","bgcolor":"#653"},{"id":1,"type":"LoadImage","pos":[-100,980],"size":[274.080078125,314.00006103515625],"flags":{},"order":9,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"COMBO","widget":{"name":"image"},"link":null},{"localized_name":"choose file to upload","name":"upload","type":"IMAGEUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","links":[174]},{"localized_name":"MASK","name":"MASK","type":"MASK","links":null}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"LoadImage","widget_ue_connectable":{}},"widgets_values":["sam_altman_512x512.jpg","image"],"color":"#233","bgcolor":"#355"},{"id":96,"type":"MarkdownNote","pos":[-110,800],"size":[290,120],"flags":{},"order":10,"mode":0,"inputs":[],"outputs":[],"title":"Load Image","properties":{"widget_ue_connectable":{}},"widgets_values":["# Put an image here\nThe best results are for 512x512 images\n\nWith a human face centered and 60% of margin"],"color":"#432","bgcolor":"#653"},{"id":17,"type":"LoadAudio","pos":[-143.86355590820312,1637.2574462890625],"size":[274.080078125,136],"flags":{},"order":11,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"COMBO","widget":{"name":"audio"},"link":null},{"localized_name":"audioUI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null},{"localized_name":"choose file to upload","name":"upload","type":"AUDIOUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"AUDIO","name":"AUDIO","type":"AUDIO","links":[57,106]}],"title":"Input audio to drive the image","properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"LoadAudio","widget_ue_connectable":{}},"widgets_values":["aud-sample-vs-1.wav",null,null],"color":"#233","bgcolor":"#355"},{"id":104,"type":"MarkdownNote","pos":[-150,1470],"size":[280,120],"flags":{},"order":12,"mode":0,"inputs":[],"outputs":[],"title":"Input audio to drive the image","properties":{"widget_ue_connectable":{}},"widgets_values":["# Put the audio here\nUse clear voice audio, avoid music that can be confused with the voice"],"color":"#432","bgcolor":"#653"},{"id":80,"type":"LoadWav2VecModel","pos":[220,1800],"size":[341.8296813964844,102],"flags":{},"order":13,"mode":0,"inputs":[{"localized_name":"model_folder","name":"model_folder","type":"COMBO","widget":{"name":"model_folder"},"link":null},{"localized_name":"target_device","name":"target_device","type":"COMBO","widget":{"name":"target_device"},"link":null}],"outputs":[{"localized_name":"sampling_rate","name":"sampling_rate","type":"INT","links":[172]},{"localized_name":"wav2vec_pipe","name":"wav2vec_pipe","type":"WAV2VEC_PIPE","links":[173]}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"cd98751e337e7ad09488b7a1af6f8d298ccdd12f","Node name for S&R":"LoadWav2VecModel","widget_ue_connectable":{}},"widgets_values":["wav2vec2-base-960h","cuda"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":67,"type":"PrimitiveFloat","pos":[530,2220],"size":[270,58],"flags":{},"order":14,"mode":0,"inputs":[{"localized_name":"value","name":"value","type":"FLOAT","widget":{"name":"value"},"link":null}],"outputs":[{"localized_name":"FLOAT","name":"FLOAT","type":"FLOAT","links":[160,167]}],"title":"FPS","properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"PrimitiveFloat","widget_ue_connectable":{"value":true}},"widgets_values":[25],"color":"#2a363b","bgcolor":"#3f5159"},{"id":105,"type":"MarkdownNote","pos":[240,1940],"size":[341.8296813964844,120],"flags":{},"order":15,"mode":0,"inputs":[],"outputs":[],"title":"Load Wav2Vec Model (for Audio Encoding)  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["Download this model from: [here](https://huggingface.co/facebook/wav2vec2-base-960h/tree/main)\n\nThe whole folder goes to `ComfyUI/models/audio/wav2vec2-base-960h/`\n\nDon't download the `.bin` and `.h5` files, the `.safetensors` is enough."],"color":"#432","bgcolor":"#653"},{"id":76,"type":"FloatAudioPreprocessAndFeatureExtract","pos":[940,1720],"size":[383.78125,182],"flags":{},"order":32,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"AUDIO","link":158},{"localized_name":"wav2vec_pipe","name":"wav2vec_pipe","type":"WAV2VEC_PIPE","link":173},{"localized_name":"target_fps","name":"target_fps","type":"FLOAT","widget":{"name":"target_fps"},"link":160},{"localized_name":"only_last_features","name":"only_last_features","type":"BOOLEAN","widget":{"name":"only_last_features"},"link":null}],"outputs":[{"localized_name":"wav2vec_features","name":"wav2vec_features","type":"TORCH_TENSOR","links":[164]},{"localized_name":"audio_num_frames","name":"audio_num_frames","type":"INT","links":[221]},{"localized_name":"processed_audio_features","name":"processed_audio_features","type":"TORCH_TENSOR","links":[163]},{"localized_name":"wav2vec_pipe_out","name":"wav2vec_pipe_out","type":"WAV2VEC_PIPE","links":null},{"localized_name":"audio","name":"audio","type":"AUDIO","links":null},{"localized_name":"fps","name":"fps","type":"FLOAT","links":null}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"ba5de66d7ccb70613c7efdfafb29f3443a27d998","Node name for S&R":"FloatAudioPreprocessAndFeatureExtract","widget_ue_connectable":{"target_fps":true,"only_last_features":true}},"widgets_values":[25,false],"color":"#2a363b","bgcolor":"#3f5159"},{"id":100,"type":"MarkdownNote","pos":[960,1550],"size":[290,88],"flags":{},"order":17,"mode":0,"inputs":[],"outputs":[],"title":"Load FLOAT Synthesis  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["Download this model from: [here](https://huggingface.co/set-soft/float_advanced/resolve/main/motion_autoencoder/decoder.safetensors?download=true)\n\nTo `ComfyUI/models/float/motion_autoencoder/`"],"color":"#432","bgcolor":"#653"},{"id":110,"type":"MarkdownNote","pos":[1620,2380],"size":[290,88],"flags":{},"order":18,"mode":0,"inputs":[],"outputs":[],"title":"Load FLOAT FMT Model  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["Download this model from: [here](https://huggingface.co/set-soft/float_advanced/resolve/main/fmt/fmt.safetensors?download=true)\n\nTo `ComfyUI/models/float/fmt/`"],"color":"#432","bgcolor":"#653"},{"id":71,"type":"Note","pos":[1920,2230],"size":[280,88],"flags":{},"order":19,"mode":0,"inputs":[],"outputs":[],"properties":{"widget_ue_connectable":{}},"widgets_values":["Some experimental values:\n\n25 fps → wav2vec_sec 2\n30 fps → wav2vec_sec 1"],"color":"#432","bgcolor":"#653"},{"id":107,"type":"MarkdownNote","pos":[960,2320],"size":[341.8296813964844,120],"flags":{},"order":20,"mode":0,"inputs":[],"outputs":[],"title":"Load Emotion Recognition Model  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["Download this model from: [here](https://huggingface.co/r-f/wav2vec-english-speech-emotion-recognition/tree/main)\n\nThe whole folder goes to `ComfyUI/models/audio/wav2vec-english-speech-emotion-recognition/`"],"color":"#432","bgcolor":"#653"},{"id":44,"type":"LoadEmotionRecognitionModel","pos":[960,2130],"size":[409.96868896484375,102],"flags":{},"order":21,"mode":0,"inputs":[{"localized_name":"model_folder","name":"model_folder","type":"COMBO","widget":{"name":"model_folder"},"link":null},{"localized_name":"target_device","name":"target_device","type":"COMBO","widget":{"name":"target_device"},"link":null}],"outputs":[{"localized_name":"emotion_model_pipe","name":"emotion_model_pipe","type":"EMOTION_MODEL_PIPE","links":[71]},{"localized_name":"dim_e","name":"dim_e","type":"INT","links":[166]}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"1734e37ec582b76a97f2a394fdef78dd654b2aea","Node name for S&R":"LoadEmotionRecognitionModel","widget_ue_connectable":{"model_folder":true,"target_device":true}},"widgets_values":["wav2vec-english-speech-emotion-recognition","cuda"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":111,"type":"MarkdownNote","pos":[1570,1900],"size":[350,90],"flags":{},"order":22,"mode":0,"inputs":[],"outputs":[],"title":"FLOAT Extract Emotion from Features  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["The output of this node represents the emotion conditioning (we). Can be from the audio or one selected."],"color":"#432","bgcolor":"#653"},{"id":36,"type":"FloatApplyAudioProjection","pos":[1810,1380],"size":[290,50],"flags":{},"order":34,"mode":0,"inputs":[{"localized_name":"wav2vec_features","name":"wav2vec_features","type":"TORCH_TENSOR","link":164},{"localized_name":"projection_layer","name":"projection_layer","type":"AUDIO_PROJECTION_LAYER","link":61}],"outputs":[{"localized_name":"wa_latent","name":"wa_latent","type":"TORCH_TENSOR","links":[216]}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"002ed938d83c893aa7646ac933776dadfa84ac33","Node name for S&R":"FloatApplyAudioProjection","widget_ue_connectable":{}},"widgets_values":[],"color":"#2a363b","bgcolor":"#3f5159"},{"id":103,"type":"MarkdownNote","pos":[1810,1470],"size":[290,88],"flags":{},"order":23,"mode":0,"inputs":[],"outputs":[],"title":"FLOAT Apply Audio Projection  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["The output of this node represents the audio conditioning (wa)"],"color":"#432","bgcolor":"#653"},{"id":112,"type":"MarkdownNote","pos":[2320,1830],"size":[320,88],"flags":{},"order":24,"mode":0,"inputs":[],"outputs":[],"title":"Sample Motion Sequence RD  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["This node makes the main inference"],"color":"#432","bgcolor":"#653"},{"id":88,"type":"ApplyFloatSynthesis","pos":[2730,1100],"size":[240.48046875,70],"flags":{},"order":37,"mode":0,"inputs":[{"localized_name":"appearance_pipe","name":"appearance_pipe","type":"FLOAT_APPEARANCE_PIPE","link":198},{"localized_name":"float_synthesis","name":"float_synthesis","type":"FLOAT_SYNTHESIS_MODEL","link":188},{"localized_name":"r_d_latents","name":"r_d_latents","type":"TORCH_TENSOR","link":220}],"outputs":[{"localized_name":"images","name":"images","type":"IMAGE","links":[190]},{"localized_name":"float_synthesis_out","name":"float_synthesis_out","type":"FLOAT_SYNTHESIS_MODEL","links":null}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"5787c6d5d82668b7c978f32f71e8731c5eaa0d8b","Node name for S&R":"ApplyFloatSynthesis","widget_ue_connectable":{}},"widgets_values":[],"color":"#2a363b","bgcolor":"#3f5159"},{"id":113,"type":"MarkdownNote","pos":[2730,950],"size":[240,88],"flags":{},"order":25,"mode":0,"inputs":[],"outputs":[],"title":"Apply FLOAT Synthesis  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["This node creates the images from the internal representation (latent space)"],"color":"#432","bgcolor":"#653"},{"id":114,"type":"FloatSampleMotionSequenceRD_VA","pos":[2320,1340],"size":[319.0738220214844,450],"flags":{},"order":36,"mode":0,"inputs":[{"localized_name":"r_s_latent","name":"r_s_latent","type":"TORCH_TENSOR","link":215},{"localized_name":"wa_latent","name":"wa_latent","type":"TORCH_TENSOR","link":216},{"localized_name":"audio_num_frames","name":"audio_num_frames","type":"INT","link":221},{"localized_name":"we_latent","name":"we_latent","type":"TORCH_TENSOR","link":218},{"localized_name":"float_fmt_model","name":"float_fmt_model","type":"FLOAT_FMT_MODEL","link":219},{"localized_name":"a_cfg_scale","name":"a_cfg_scale","type":"FLOAT","widget":{"name":"a_cfg_scale"},"link":null},{"localized_name":"r_cfg_scale","name":"r_cfg_scale","type":"FLOAT","widget":{"name":"r_cfg_scale"},"link":null},{"localized_name":"e_cfg_scale","name":"e_cfg_scale","type":"FLOAT","widget":{"name":"e_cfg_scale"},"link":null},{"localized_name":"include_r_cfg","name":"include_r_cfg","type":"BOOLEAN","widget":{"name":"include_r_cfg"},"link":null},{"localized_name":"nfe","name":"nfe","type":"INT","widget":{"name":"nfe"},"link":null},{"localized_name":"torchdiffeq_ode_method","name":"torchdiffeq_ode_method","type":"COMBO","widget":{"name":"torchdiffeq_ode_method"},"link":null},{"localized_name":"ode_atol","name":"ode_atol","type":"FLOAT","widget":{"name":"ode_atol"},"link":null},{"localized_name":"ode_rtol","name":"ode_rtol","type":"FLOAT","widget":{"name":"ode_rtol"},"link":null},{"localized_name":"audio_dropout_prob","name":"audio_dropout_prob","type":"FLOAT","widget":{"name":"audio_dropout_prob"},"link":null},{"localized_name":"ref_dropout_prob","name":"ref_dropout_prob","type":"FLOAT","widget":{"name":"ref_dropout_prob"},"link":null},{"localized_name":"emotion_dropout_prob","name":"emotion_dropout_prob","type":"FLOAT","widget":{"name":"emotion_dropout_prob"},"link":null},{"localized_name":"fix_noise_seed","name":"fix_noise_seed","type":"BOOLEAN","widget":{"name":"fix_noise_seed"},"link":null},{"localized_name":"seed","name":"seed","type":"INT","widget":{"name":"seed"},"link":null}],"outputs":[{"localized_name":"r_d_latents (Wr→D)","name":"r_d_latents (Wr→D)","type":"TORCH_TENSOR","links":[220]},{"localized_name":"float_fmt_model_out","name":"float_fmt_model_out","type":"FLOAT_FMT_MODEL","links":null}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"e5945270df082102f672c20bf4a46cee936cc571","Node name for S&R":"FloatSampleMotionSequenceRD_VA","widget_ue_connectable":{}},"widgets_values":[2,1,1,false,10,"euler",0.00001,0.00001,0.1,0.1,0.1,true,15,"fixed"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":78,"type":"LoadFMTModel","pos":[1620,2040],"size":[288.4283142089844,310],"flags":{},"order":29,"mode":0,"inputs":[{"localized_name":"fmt_file","name":"fmt_file","type":"COMBO","widget":{"name":"fmt_file"},"link":null},{"localized_name":"target_device","name":"target_device","type":"COMBO","widget":{"name":"target_device"},"link":null},{"localized_name":"cudnn_benchmark","name":"cudnn_benchmark","type":"BOOLEAN","widget":{"name":"cudnn_benchmark"},"link":null},{"localized_name":"dim_e","name":"dim_e","type":"INT","widget":{"name":"dim_e"},"link":166},{"localized_name":"num_heads","name":"num_heads","type":"INT","widget":{"name":"num_heads"},"link":null},{"localized_name":"attention_window","name":"attention_window","type":"INT","widget":{"name":"attention_window"},"link":null},{"localized_name":"num_prev_frames","name":"num_prev_frames","type":"INT","widget":{"name":"num_prev_frames"},"link":null},{"localized_name":"fps","name":"fps","type":"FLOAT","widget":{"name":"fps"},"link":167},{"localized_name":"wav2vec_sec","name":"wav2vec_sec","type":"FLOAT","widget":{"name":"wav2vec_sec"},"link":null}],"outputs":[{"localized_name":"float_fmt_model","name":"float_fmt_model","type":"FLOAT_FMT_MODEL","links":[219]},{"localized_name":"fps","name":"fps","type":"FLOAT","links":[171]},{"localized_name":"fmt_options_out","name":"fmt_options_out","type":"ADV_FLOAT_DICT","links":[]},{"localized_name":"conditioning_chunk_size","name":"conditioning_chunk_size","type":"INT","links":null}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"946cba9c08d2ece9be39f6af8925b29ef9ddaddc","Node name for S&R":"LoadFMTModel","widget_ue_connectable":{"fmt_file":true,"target_device":true,"cudnn_benchmark":true,"dim_e":true,"num_heads":true,"attention_window":true,"num_prev_frames":true,"fps":true,"wav2vec_sec":true}},"widgets_values":["fmt.safetensors","cuda",false,7,8,2,10,25,2],"color":"#2a363b","bgcolor":"#3f5159"},{"id":109,"type":"MarkdownNote","pos":[530,2320],"size":[380,170],"flags":{},"order":26,"mode":0,"inputs":[],"outputs":[],"title":"FPS","properties":{"widget_ue_connectable":{}},"widgets_values":["The model was trained using 25 fps\n\nIf you change it the size of the conditioning will change and you might need adjusts to compensate the change.\n\nSee the  `Load FLOAT FMT Model (VA)` node\n\nBut you can cheat and don't use this value in the \"Load FLOAT FMT Model (VA)\" and send it directly to the \"Video Combine\" node. This is what the normal and advanced workflows does.\n\nThis avoids messing with the conditioning parameters."],"color":"#432","bgcolor":"#653"},{"id":45,"type":"FloatExtractEmotionWithCustomModel","pos":[1571.390625,1782.145751953125],"size":[347.5732727050781,78],"flags":{},"order":35,"mode":0,"inputs":[{"localized_name":"processed_audio_features","name":"processed_audio_features","type":"TORCH_TENSOR","link":163},{"localized_name":"emotion_model_pipe","name":"emotion_model_pipe","type":"EMOTION_MODEL_PIPE","link":71},{"localized_name":"emotion","name":"emotion","type":"COMBO","widget":{"name":"emotion"},"link":null}],"outputs":[{"localized_name":"we_latent","name":"we_latent","type":"TORCH_TENSOR","links":[218]},{"localized_name":"emotion_model_pipe_out","name":"emotion_model_pipe_out","type":"EMOTION_MODEL_PIPE","links":null}],"properties":{"aux_id":"set-soft/ComfyUI-FLOAT","ver":"1734e37ec582b76a97f2a394fdef78dd654b2aea","Node name for S&R":"FloatExtractEmotionWithCustomModel","widget_ue_connectable":{"emotion":true}},"widgets_values":["none"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":108,"type":"MarkdownNote","pos":[941.078125,1950.671875],"size":[380,88],"flags":{},"order":16,"mode":0,"inputs":[],"outputs":[],"title":"FLOAT Audio Feature Extract  (VA)","properties":{"widget_ue_connectable":{}},"widgets_values":["This model process the audio and generates a representation that will be used to extract the emotion and the audio conditioning"],"color":"#432","bgcolor":"#653"}],"links":[[57,17,0,34,0,"AUDIO"],[61,35,0,36,1,"AUDIO_PROJECTION_LAYER"],[71,44,0,45,1,"EMOTION_MODEL_PIPE"],[106,17,0,57,1,"AUDIO"],[113,55,0,58,1,"FLOAT_SYNTHESIS_MODEL"],[158,34,0,76,0,"AUDIO"],[160,67,0,76,2,"FLOAT"],[163,76,2,45,0,"TORCH_TENSOR"],[164,76,0,36,0,"TORCH_TENSOR"],[166,44,1,78,3,"INT"],[167,67,0,78,7,"FLOAT"],[171,78,1,57,4,"FLOAT"],[172,80,0,34,2,"INT"],[173,80,1,76,1,"WAV2VEC_PIPE"],[174,1,0,81,0,"IMAGE"],[175,81,0,82,0,"IMAGE"],[183,53,0,81,4,"INT"],[188,58,0,88,1,"FLOAT_SYNTHESIS_MODEL"],[190,88,0,57,0,"IMAGE"],[191,81,0,89,0,"IMAGE"],[192,53,3,89,1,"FLOAT_ENCODER_MODEL"],[197,89,1,58,0,"TORCH_TENSOR"],[198,89,0,88,0,"FLOAT_APPEARANCE_PIPE"],[215,58,1,114,0,"TORCH_TENSOR"],[216,36,0,114,1,"TORCH_TENSOR"],[218,45,0,114,3,"TORCH_TENSOR"],[219,78,0,114,4,"FLOAT_FMT_MODEL"],[220,114,0,88,2,"TORCH_TENSOR"],[221,76,1,114,2,"INT"]],"groups":[],"config":{},"extra":{"ds":{"scale":0.9275386206062305,"offset":[-381.53842937005726,-1456.0697404503692]},"reroutes":[{"id":18,"pos":[143.866455078125,1657.9619140625],"linkIds":[57,106]},{"id":19,"parentId":18,"pos":[280,2490],"linkIds":[106]},{"id":22,"parentId":24,"pos":[2848.205322265625,2137.818603515625],"linkIds":[106]},{"id":24,"parentId":19,"pos":[1940,2500],"linkIds":[106]},{"id":26,"pos":[1354.6282958984375,1405.0250244140625],"linkIds":[164]},{"id":27,"pos":[2911.781005859375,1970.36376953125],"linkIds":[171]},{"id":28,"pos":[1610,1730],"linkIds":[221]},{"id":29,"parentId":28,"pos":[2010,1690],"linkIds":[221]}],"ue_links":[],"links_added_by_ue":[],"linkExtensions":[{"id":57,"parentId":18},{"id":106,"parentId":22},{"id":164,"parentId":26},{"id":171,"parentId":27},{"id":221,"parentId":29}]},"version":0.4}
